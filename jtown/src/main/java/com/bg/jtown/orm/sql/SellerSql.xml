<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sellerMapper">

	<resultMap type="com.bg.jtown.security.JtownUser" id="jtown-seller-map">
		<result column="pn" property="pn"/>
		<result column="shop_name" property="shopName"/>
		<result column="shop_url" property="shopUrl"/>
		<result column="notice" property="notice"/>
		<result column="love_count" property="loveCount"/>
		<result column="view_count" property="viewCount"/>
	</resultMap>

	<select id="selectSellerInformation" parameterType="java.lang.Integer" resultMap="jtown-seller-map">
		SELECT
			pn, shop_name, shop_url, notice, love_count, view_count
		FROM
			user_seller
		WHERE
			pn = #{properNumber}
	</select>
	
	<select id="selectSellerImage" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT
			usin.save_name
		FROM
			user_seller_image_name usin
		WHERE
			usin.seller_pn = #{properNumber}
	</select>
	
	<insert id="insertSellerImage" parameterType="com.bg.jtown.util.FileVO">
		INSERT INTO
			user_seller_image
			(	seller_pn, image_pn, image_order	)
		VALUES
			(	#{ownerPn}, #{imagePn}, 1	)
	</insert>
	
	<update id="updateSellerImage" parameterType="com.bg.jtown.util.FileVO">
		UPDATE 
			user_seller_image
		SET
			image_pn = #{imagePn} 
		WHERE
			seller_pn = #{ownerPn}
		AND
			image_order = 1
	</update>
	
	<update id="updateSellerNotice" parameterType="com.bg.jtown.security.JtownUser">
		UPDATE
			user_seller
		SET
			notice = #{notice}
		WHERE
			pn = #{pn}
	</update>
	
	<resultMap type="com.bg.jtown.business.Event" id="jtown-event-map">
		<result column="pn" property="pn"/>
		<result column="seller_pn" property="sellerPn"/>
		<result column="banner_type" property="bannerType"/>
		<result column="image_pn" property="imagePn"/>
		<result column="content" property="content"/>
		<result column="banner_order" property="bannerOrder"/>
		<result column="save_name" property="saveName"/>
	</resultMap>
	
	<select id="selectSellerEvent" parameterType="java.lang.Integer" resultMap="jtown-event-map">
		SELECT
			usb.pn, usb.seller_pn, usb.banner_type, usb.image_pn, usb.content, usb.banner_order,
			i.save_name
		FROM
			user_seller_banner usb 
			LEFT OUTER JOIN image i
			ON usb.image_pn = i.pn
		WHERE
			usb.seller_pn = #{properNumber}
		ORDER BY usb.banner_order
	</select>	
	
	<insert id="insertSellerEvent" parameterType="com.bg.jtown.business.Event">
		INSERT INTO
			user_seller_banner
			(	seller_pn, banner_type, image_pn, content, banner_order)
		VALUES
			(	#{sellerPn}, #{bannerType}, #{imagePn}, #{content}, #{bannerOrder} )
		<selectKey resultType="java.lang.Integer" keyProperty="pn">
			SELECT LAST_INSERT_ID()
		</selectKey>	
	</insert>
	
	<update id="updateSellerEvent" parameterType="com.bg.jtown.business.Event">
		UPDATE
			user_seller_banner
		SET
			banner_type = #{bannerType},
			image_pn = #{imagePn},
			content = #{content}
		WHERE
			pn = #{pn}
		AND
			seller_pn = #{sellerPn}
	</update>

	<select id="selectSellerInterest" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT
			ise.name
		FROM
			user_seller_interest usi,
			interest_section ise
		WHERE
			usi.seller_pn = #{properNumber}
		AND
			usi.section_pn  = pn 
	</select>

</mapper>