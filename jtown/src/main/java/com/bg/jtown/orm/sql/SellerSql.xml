<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sellerMapper">

	<resultMap type="com.bg.jtown.security.JtownUser" id="jtown-seller-map">
		<result column="pn" property="pn"/>
		<result column="shop_name" property="shopName"/>
		<result column="shop_url" property="shopUrl"/>
		<result column="notice" property="notice"/>
		<result column="love_count" property="loveCount"/>
		<result column="view_count" property="viewCount"/>
		<result column="comment_count" property="commentCount"/>
	</resultMap>

	<select id="selectSellerInformation" parameterType="java.lang.Integer" resultMap="jtown-seller-map">
		SELECT
			us.pn, us.shop_name, us.shop_url, us.notice, cvsp.view_count, clsp.love_count, ccsp.comment_count
		FROM
			user_seller us
			LEFT OUTER JOIN count_love_seller_pn clsp
			ON us.pn = clsp.seller_pn
			LEFT OUTER JOIN count_comment_seller_pn ccsp
			ON us.pn = ccsp.seller_pn
			LEFT OUTER JOIN count_view_seller_pn cvsp
			ON us.pn = cvsp.seller_pn
		WHERE
			us.pn = #{properNumber}
	</select>
	
	<!-- Seller Image -->
	
	<select id="selectSellerImage" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT
			usin.save_name
		FROM
			user_seller_image_name usin
		<if test="value != null">
		WHERE
			usin.seller_pn = #{value}		
		</if>	
	</select>
	
	<select id="selectSellerImageOne" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT
			usin.save_name
		FROM
			user_seller_image_name usin
		<if test="properNumber != null">
		WHERE
			usin.seller_pn = #{properNumber}		
			<if test="imagePn != null">
			AND
				usin.image_pn = #{imagePn}
			</if>
		</if>	
	</select>
	
	<select id="selectSellerImageCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT
			COUNT(*)
		FROM
			user_seller_image
		<if test="value != null">
		WHERE
			seller_pn = #{value}
		</if>
	</select>
	
	<insert id="insertSellerImage" parameterType="com.bg.jtown.util.FileVO">
		INSERT INTO
			user_seller_image
			(	seller_pn, image_pn, image_order	)
		VALUES
			(	#{ownerPn}, #{imagePn}, 1	)
	</insert>
	
	<update id="updateSellerImage" parameterType="com.bg.jtown.util.FileVO">
		UPDATE 
			user_seller_image
		SET
			image_pn = #{imagePn} 
		WHERE
			seller_pn = #{ownerPn}
		AND
			image_order = 1
	</update>
	
	<delete id="deleteSellerImage" parameterType="java.lang.Integer">
		DELETE FROM
			user_seller_image
		<if test="properNumber != null">
		WHERE
			seller_pn = #{properNumber}		
		</if>
	</delete>
	
	<update id="updateSellerNotice" parameterType="com.bg.jtown.security.JtownUser">
		UPDATE
			user_seller
		SET
			notice = #{notice}
		WHERE
			pn = #{pn}
	</update>
	
	<resultMap type="com.bg.jtown.business.Event" id="jtown-event-map">
		<result column="pn" property="pn"/>
		<result column="seller_pn" property="sellerPn"/>
		<result column="banner_type" property="bannerType"/>
		<result column="image_pn" property="imagePn"/>
		<result column="content" property="content"/>
		<result column="banner_order" property="bannerOrder"/>
		<result column="save_name" property="saveName"/>
	</resultMap>
	
	<select id="selectSellerEvent" parameterType="java.lang.Integer" resultMap="jtown-event-map">
		SELECT
			usb.pn, usb.seller_pn, usb.banner_type, usb.image_pn, usb.content, usb.banner_order,
			i.save_name
		FROM
			user_seller_banner usb 
			LEFT OUTER JOIN image i
			ON usb.image_pn = i.pn
		WHERE
			usb.seller_pn = #{properNumber}
		ORDER BY usb.banner_order
	</select>	
	
	<insert id="insertSellerEvent" parameterType="com.bg.jtown.business.Event">
		INSERT INTO
			user_seller_banner
			(	seller_pn, banner_type, image_pn, content, banner_order, input_date)
		VALUES
			(	#{sellerPn}, #{bannerType}, #{imagePn}, #{content}, #{bannerOrder}, SYSDATE() )
		<selectKey resultType="java.lang.Integer" keyProperty="pn">
			SELECT LAST_INSERT_ID()
		</selectKey>	
	</insert>
	
	<update id="updateSellerEvent" parameterType="com.bg.jtown.business.Event">
		UPDATE
			user_seller_banner
		SET
			banner_type = #{bannerType},
			image_pn = #{imagePn},
			content = #{content},
			input_date = SYSDATE()
		WHERE
			pn = #{pn}
		AND
			seller_pn = #{sellerPn}
	</update>

	<select id="selectSellerInterest" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT
			ise.name
		FROM
			user_seller_interest usi,
			interest_section ise
		WHERE
			usi.seller_pn = #{properNumber}
		AND
			usi.section_pn  = pn 
	</select>

	<select id="selectSellerProduct" parameterType="java.lang.Integer" resultType="com.bg.jtown.business.Product">
		SELECT
			usp.pn, i.save_name AS saveName
		FROM
			user_seller_product usp,
			image i
		WHERE
			usp.seller_pn = #{userPn}
		AND
			usp.image_pn = i.pn
		ORDER BY
			usp.input_date DESC	
	</select>
	
	<select id="selectSellerProductCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT	COUNT(pn) FROM	user_seller_product WHERE seller_pn = #{userPn}
	</select>
	
	<select id="selectSellerProductOne" parameterType="java.lang.Integer" resultType="com.bg.jtown.business.Product">
		SELECT
			pn, seller_pn AS sellerPn, image_pn AS imagePn
		FROM
			user_seller_product
		WHERE
			pn = #{productPn}
	</select>
	
	<delete id="deleteSellerProduct" parameterType="com.bg.jtown.business.Product">
		DELETE	FROM
			user_seller_product
		<if test="pn != null">
		WHERE
			pn = #{pn}
		AND
			seller_pn = #{sellerPn}		
		</if>
	</delete>
	
	<insert id="insertSellerProduct" parameterType="com.bg.jtown.business.Product">
		INSERT INTO
			user_seller_product
			(	seller_pn,	image_pn, input_date )
		VALUES
			(	#{sellerPn}, #{imagePn}, SYSDATE() )
		<selectKey resultType="java.lang.Integer" keyProperty="pn">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<select id="selectCommentCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT
			comment_count
		FROM	
			count_comment_seller_pn
		WHERE
			seller_pn = #{properNumber}
	</select>

	<select id="selectLoveCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT
			COUNT(*)
		FROM	
			count_love
		WHERE
			seller_pn = #{properNumber}
	</select>

</mapper>