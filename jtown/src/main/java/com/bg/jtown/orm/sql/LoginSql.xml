<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="LoginMapper">
	<select id="checkExistEmail" parameterType="String" resultType="Integer">
		SELECT
			count(*)
		FROM
			users
		WHERE
			id = #{id}
	</select>
	
	<insert id="insertUsers" parameterType="JtownUser">
		INSERT INTO
			users
			(
				id, password, enable, salt
			)
		VALUES
			(
				#{username}, #{password}, #{enabled}, #{salt}
			)
		<selectKey keyProperty="pn" resultType="Integer">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<insert id="insertUserCustomer" parameterType="JtownUser">
		INSERT INTO
			user_customer
			(
				pn, name, join_date
			)
		VALUES
			(
				#{pn}, #{name}, SYSDATE()
			)			
	</insert>
	
	<insert id="insertUserSeller" parameterType="JtownUser">
		INSERT
			user_seller
			(
				pn, shop_name, shop_url
			)		
		VALUES
			(
				#{pn}, #{shopName}, #{shopUrl}
			)
	</insert>	
	
	<select id="findGroupId" parameterType="String" resultType="Integer">
		SELECT
			id
		FROM
			groups
		WHERE
			group_name = #{group}
	</select>
	
	<insert id="addUserToGroup" parameterType="Map">
		INSERT INTO
			group_members
			(
				group_id, user_pn
			)
		VALUES
			(
				#{groupId}, #{userPn}
			)

	</insert>
	
	<update id="changePassword" parameterType="JtownUser">
		UPDATE
			users
		SET
			password = #{newPassword},
			salt = #{salt}
		WHERE
			id = #{username}
	</update>
</mapper>