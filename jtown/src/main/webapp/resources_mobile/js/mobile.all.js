/*************************
 * MIT licensed
 *
 * Copyright (C) 2013 peoplegate - made by Francis ( Project : businessgate)
 * ***********************/
$(function(){$(".mm-home-nav-title").toggle(function(){$(".mm-home-sub-nav").hide();$(this).parents("li").find(".mm-home-sub-nav").show()},function(){$(this).parents("li").find(".mm-home-sub-nav").hide()});$(".mm-join-submit").bind("click",function(){$("body").bind("touchmove",function(b){b.preventDefault()});$("html").css("overflow","hidden");$("#loading-popup").fadeIn();var a=document.forms.jtownUser;a.submit()});$(".mm-mir-header>a").bind("click",function(){var b=$(this),a=b.attr("data-spn");$.postJSON(mobileContextPath+"/ajax/goHome.jt",{sellerPn:a},function(){})});$("#mm-pc-version-btn").bind("click",function(){$.cookie("SEE_PC_VERSION","T",{expires:1,path:"/"})});$(".mm-home-refresh").bind("click",function(){location.reload()});$(".mm-home-search").bind("click",function(){$("#mm-naturalLanguage-search").focus()});mobile.homeSync();mobile.mirSync();mobile.commentSync();mobile.autocomplete();$("#mm-home-container").scrollPagination({contentPage:mobileContextPath+"/ajax/homePagination.jt",contentData:{categoryPn:Number($("#mm-home-container").attr("data-cpn")),sectionPn:Number($("#mm-home-container").attr("data-spn"))},scrollTarget:$(window),successCallback:function(c){var b=mobile.homeHtml(c);var a=$(b);$("#mm-home-container").append(a);setTimeout("mobile.homeSync();",0)},maxPage:$("#mm-home-container").attr("data-maxPage")});$("#mm-userFindPassword-btn").bind("click",function(){$("body").bind("touchmove",function(b){b.preventDefault()});$("html").css("overflow","hidden");$("#loading-popup").fadeIn();var a=document.forms.jtownUser;a.submit()});$("#mm-findSellerPassword-btn").bind("click",function(){$("body").bind("touchmove",function(b){b.preventDefault()});$("html").css("overflow","hidden");$("#loading-popup").fadeIn();var a=document.forms.sellerUser;a.submit()});mirProductHeight=function(){var a=$(".mm-mir-product-one-image").width();$(".mm-mir-product-one-image>a").height(a);$(".mm-mir-product-one-image>a>img").height(a)};mirProductHeight();$(window).resize(mirProductHeight)});function onPopupLoginSubmit(){onLoginSubmit("mm-page-login-form")}function onLoginSubmit(b){var a=$("#"+b);jQuery.ajax({type:"POST",url:contextPath+"/j_spring_security_check",data:a.serialize(),dataType:"text",success:function(c){mobile.loginControl(c,b)}})}mobile.loginControl=function(data,name){var map=eval("("+data+")"),result=map.result,referer=map.referer;if(result=="success"){if(nullValueCheck(referer)){location.href=mobileContextPath+"/"}else{location.href=referer}return}else{if(result=="error"){location.href=mobileContextPath+"/login/?isFinish=0";return}}};mobile.autocomplete=function(){$.widget("custom.catcomplete",$.ui.autocomplete,{_renderMenu:function(c,b){var d=this,a="";$.each(b,function(e,f){if(f.category!=a){c.append('<li class="ui-autocomplete-category"><span class="ui-autocomplete-category-span">'+f.category+"</span></li>");a=f.category}d._renderItem=function(g,h){return $("<li>").append('<a class="ui-catcomplete-menu-item">'+h.label+"</a>").appendTo(g)};d._renderItemData(c,f)})}});$("#mm-naturalLanguage-search").catcomplete({source:function(d,a){var b=mobileContextPath+"/natural/ajax/autocomplete.jt",c={searchName:d.term};$.postJSON(b,c,function(g){var f=g.jtownUsers,e=g.interests,h=[];for(var j=0,k=f.length;j<k;j++){var m=f[j];h[j]={label:m.name,value:m.name,pn:m.pn,category:"SHOP"}}for(var j=0,k=e.length,n=f.length;j<k;j++){var l=e[j];h[j+n]={label:l.name,value:l.name,categoryPn:l.categoryPn,spn:l.sectionPn,category:"CATEGORY"}}a(h)})},minLength:1,select:function(b,c){var a=c.item;if(a.category=="SHOP"){location.href=mobileContextPath+"/mir/"+a.pn}else{if(a.category=="CATEGORY"){location.href=mobileContextPath+"/cpn/"+a.categoryPn+"/spn/"+a.spn}}},focus:function(a,b){$(".ui-state-focus").removeClass("ui-corner-all").removeClass("ui-state-focus")},open:function(){$(".ui-autocomplete").removeClass("ui-widget-content").addClass("ui-catcomplete-content");$(this).addClass("ui-catcomplete-input");$(".ui-menu").css({padding:0})},close:function(){$(this).removeClass("ui-catcomplete-input");$("#mm-naturalLanguage-search").val("")}})};mobile.product=function(c,a){var b=window.open("about:blank");b.location.href=a;$.postJSON(mobileContextPath+"/ajax/goHome.jt",{sellerPn:c},function(){})};mobile.mirSync=function(){$(".mm-mir-love").bind("click",function(){var d=$(this).parents(".mm-mir-footer");var c=d.attr("data-spn");var a=mobileContextPath+"/ajax/clickLove.jt",b={sellerPn:c};$.postJSON(a,b,function(g){if(!nullValueCheck(g.message)){if(g.message=="1"){location.href=mobileContextPath+"/login"}else{alert("판매자는 불가능합니다")}}else{var e=g.crudType;var f=d.find(".mm-love-click-background");if(e=="insert"){f.addClass("mm-love-animation")}else{if(e=="delete"){f.removeClass("mm-love-animation")}}}})});$("#comment-add-btn").bind("click",function(f){var e=$(this),g=(Number(e.attr("data-page"))+1),a=(g+1),h=e.attr("data-nipp"),d=e.attr("data-ni");var b=mobileContextPath+"/home/ajax/selectComment.jt";var c={page:g,sellerPn:e.attr("data-spn")};$.postJSON(b,c,function(l){for(var k=0,j=l.length;k<j;k++){var m=l[k];mobile.comment(m,"last")}setTimeout("mobile.commentSync()",0);if(a*h<d||(g*h<d&&a*h>=d)){e.attr("data-page",g);$("#comment-now-count").html(g*h)}else{e.parents("li").remove()}})});$(".mm-mir-comment-insert").bind("click focusin focusout",function(f){if(f.type=="click"){var e=$(this),g=e.parents(".mm-mir-footer"),d=g.attr("data-spn"),b=g.attr("data-name");var a=mobileContextPath+"/home/ajax/existComment.jt",c={sellerPn:d};$.postJSON(a,c,function(j){var h=j.result,i=j.authority;if(i=="NOT_LOGIN"){location.href=mobileContextPath+"/login";return}else{if(i!="CUSTOMER"){e.unbind("click");return}}if(h){e.attr("readonly","readonly");alert(b+" 쇼핑몰에 대한 댓글은 하루에 한번만 가능합니다.")}else{e.removeAttr("readonly")}})}else{if(f.type=="focusin"){$(".mm-mir-comment-insert-btn").show()}}});$(".mm-mir-comment-insert-btn").bind("click",function(d){var c=$(this),e=$(".mm-mir-comment-insert");footer=c.parents(".mm-mir-footer"),spn=footer.attr("data-spn"),name=footer.attr("data-name");comment=e.val();if(nullValueCheck(comment)){return}var a,b={sellerPn:spn};a=mobileContextPath+"/home/ajax/existLove.jt";$.postJSON(a,b,function(f){postComment=function(){a=mobileContextPath+"/home/ajax/insertComment.jt";b.comment=comment;$.postJSON(a,b,function(g){e.val("");e.attr("readonly","readonly")})};if(!f){mobile.loveConfirm(function(){a=mobileContextPath+"/ajax/clickLove.jt";b={sellerPn:spn};$.postJSON(a,b,function(i){if(!nullValueCheck(i.message)){if(i.message=="1"){location.href=mobileContextPath+"/login"}else{alert("판매자는 불가능합니다")}}else{var g=i.crudType;var h=parent.find(".mm-love-click-background");if(g=="insert"){h.addClass("mm-love-animation")}else{if(g=="delete"){h.removeClass("mm-love-animation")}}}});setTimeout("postComment()",0)},function(){postComment()},name)}else{postComment()}})})};mobile.loveConfirm=function(d,c,a){var b="";b+='<div class="mm-love-dialog">';b+='	<div class="mm-love-dialog-ment">';b+="		댓글 입력이 완료되었습니다.<br/>쇼핑몰&nbsp;"+a+"을 추천하시겠어요?";b+="	</div>";b+='	<div class="mm-love-dialog-buttonpane">';b+='		<div class="mm-love-dialog-button">';b+='			<span id="smart-success">Love</span>';b+="		</div>";b+='		<div class="mm-love-dialog-button">';b+='			<span id="smart-cancle">Skip</span>';b+="		</div>";b+="	</div>";b+="</div>";$.smartPop.open({width:280,height:120,html:b,effect:null});syncConfirm=function(){$("#smart-success").bind("click",function(){d();$.smartPop.close()});$("#smart-cancle").bind("click",function(){c();$.smartPop.close()})};setTimeout("syncConfirm()",0)};mobile.commentSync=function(){$(".mm-warn-active").unbind("click").bind("click",function(){var d=$(this),b=d.parents(".mm-mir-comment-content-text"),e=b.attr("data-copn");var a=mobileContextPath+"/home/ajax/warnCommentLove.jt";var c={commentPn:e};$.postJSON(a,c,function(f){if(!nullValueCheck(f.message)){alert(f.message)}else{d.removeClass("mm-warn-active").addClass("mm-warn-disactive").unbind("click")}})});$(".mm-mir-comment-text-footer-loveIt").unbind("click").bind("click",function(){var d=$(this),b=d.parents(".mm-mir-comment-content-text"),e=d.parents(".mm-mir-footer");var a=mobileContextPath+"/home/ajax/toggleCommentLove.jt";var c={commentPn:b.attr("data-copn"),sellerPn:e.attr("data-spn")};$.postJSON(a,c,function(g){if(!nullValueCheck(g.message)){switch(Number(g.message)){case 1:location.href=mobileContextPath+"/login";break;case 2:alert("판매자는 불가능 합니다.");break;default:break}}else{var f=g.crudType;if(f=="insert"){$(".comment-love-"+g.commentPn+" .mm-mir-comment-text-footer-loveIt-count").after('<span class="mm-mir-comment-text-footer-loveIt-cancle">&nbsp;취소</a>');commentLoveCancle()}else{if(f=="delete"){$(".comment-love-"+g.commentPn).find(".mm-mir-comment-text-footer-loveIt-cancle").remove()}}}})});commentLoveCancle=function(){$(".mm-mir-comment-text-footer-loveIt-cancle").unbind("click").bind("click",function(){var d=$(this),b=d.parents(".mm-mir-comment-content-text"),e=d.parents(".mm-mir-footer");var a=mobileContextPath+"/home/ajax/toggleCommentLove.jt";var c={commentPn:b.attr("data-copn"),sellerPn:e.attr("data-spn")};$.postJSON(a,c,function(g){if(!nullValueCheck(g.message)){location.href=mobileContextPath+"/login"}else{var f=g.crudType;if(f=="delete"){$(".comment-love-"+g.commentPn).find(".mm-mir-comment-text-footer-loveIt-cancle").remove()}}})})};commentLoveCancle();$(".mm-comment-delete").unbind("click").bind("click",function(){var d=$(this),g=d.parents(".mm-mir-footer"),c=g.attr("data-spn"),f=d.parents(".mm-mir-comment-content-text"),e=f.attr("data-copn");var a=mobileContextPath+"/home/ajax/deleteComment.jt",b={commentPn:e,sellerPn:c};$.postJSON(a,b,function(){})});$(".mm-comment-update").unbind("click").bind("click",function(){var c=$(this),d=c.parents(".mm-mir-comment-content-text"),a=d.find(".mm-comment-update-wrap"),b=d.find(".mm-mir-comment-text-wrap");b.hide();a.show()});$(".mm-commnet-cancle-btn").unbind("click").bind("click",function(){var d=$(this),e=d.parents(".mm-mir-comment-content-text"),b=e.find(".mm-comment-update-wrap"),c=e.find(".mm-mir-comment-text-wrap"),a=c.find(".mm-mir-comment-text-content-text").html();c.show();b.hide();b.find(".mm-mir-comment-update").val(a)});$(".mm-commnet-update-btn").unbind("click").bind("click",function(){var f=$(this),g=f.parents(".mm-mir-comment-content-text"),b=g.find(".mm-comment-update-wrap"),c=g.find(".mm-mir-comment-text-wrap"),a=b.find(".mm-mir-comment-update").val();var d=mobileContextPath+"/home/ajax/updateComment.jt",e={commentPn:g.attr("data-copn"),comment:a};if(nullValueCheck(a)){return}$.postJSON(d,e,function(h){c.show();b.hide()})})};mobile.comment=function(h,b){var e=$("body").attr("data-cpn");var f='<span class="mm-mir-comment-text-footer-loveIt-cancle">취소</span>';var a=nullValueCheck(h.commentCustomerPn)?"":f;var d="";if(h.customerPn!=e){if(nullValueCheck(h.warnCustomerPn)){d='<span class="mm-warn-active" title="신고">WARN</span>'}else{d='<span class="mm-warn-disactive" title="신고">WARN</span>'}}var c="";c+='<li data-copn="'+h.commentPn+'" class="mm-mir-comment-content-text comment-not-best">';c+='	<ul class="mm-mir-comment-text-wrap">';c+='		<li class="mm-mir-comment-text-content">';c+='			<span class="mm-mir-comment-text-content-name">'+htmlChars(h.customerName)+"</span>";c+=' 			<span class="mm-mir-comment-text-content-text">'+htmlChars(h.comment)+"</span>";c+="		</li>";c+='		<li class="mm-mir-comment-text-footer comment-love-'+h.commentPn+'">';c+='			<span class="mm-mir-comment-text-footer-progress-date">'+h.inputDate+"</span>";c+=' 			<span class="mm-mir-comment-text-footer-loveIt">LOVE</span>';c+='			<span class="mm-mir-comment-text-footer-loveIt-count">'+(nullValueCheck(h.commentLoveCount)?"":h.commentLoveCount)+"</span>";c+="			"+a;c+="			"+d;if(h.customerPn==e){c+='				<span class="mm-comment-delete">삭제</span>';c+='				<span class="mm-comment-update">수정</span>'}c+="		</li>";c+="	</ul>";if(h.customerPn==e){c+='	<div class="mm-comment-update-wrap">';c+='		<input type="text" maxlength="100" value="'+htmlChars(h.comment)+'" class="mm-mir-comment-update"/><br/>';c+='		<button type="button" class="mm-btn-orange mm-commnet-cancle-btn">취소</button>';c+='		<button type="button" class="mm-btn-orange mm-commnet-update-btn">수정</button>';c+="	</div>"}c+="</li>";var g=$(".mm-mir-comment-content>ul");if(!nullValueCheck(g.html().trim())){if(b=="last"){$(".comment-not-best:last").after(c)}else{if(b=="first"){$(".comment-not-best:first").before(c)}}}else{g.html(c)}};mobile.homeSync=function(){$(".mm-home-love").unbind("click").bind("click",function(){var d=$(this).parents(".mm-home-article");var c=d.attr("data-spn");var a=mobileContextPath+"/ajax/clickLove.jt",b={sellerPn:c};$.postJSON(a,b,function(g){if(!nullValueCheck(g.message)){if(g.message=="1"){location.href=mobileContextPath+"/login"}else{alert("판매자는 불가능합니다")}}else{var e=g.crudType;var f=d.find(".mm-love-click-background");if(e=="insert"){f.addClass("mm-love-animation")}else{if(e=="delete"){f.removeClass("mm-love-animation")}}}})});$(".mm-home-article-header>a").unbind("click").bind("click",function(){var b=$(this).parents(".mm-home-article");var a=b.attr("data-spn");$.postJSON(mobileContextPath+"/ajax/goHome.jt",{sellerPn:a},function(){})});$(".mm-home-mainImage").unbind("click").bind("click",function(){var b=$(this).parents(".mm-home-article");var a=b.attr("data-spn");location.href=mobileContextPath+"/mir/"+a});$(".mm-home-comment").unbind("click").bind("click",function(){var b=$(this).parents(".mm-home-article");var a=b.attr("data-spn");location.href=mobileContextPath+"/mir/"+a})};mobile.homeHtml=function(y){var p=y.jtownUsers;var h=y.images;var z=y.newComments;var l="";for(var r=0,t=p.length;r<t;r++){var c=p[r],f=c.pn,k=h[f],e=z[f];var d="";if(k.length==0){d+='<div class="mm-home-mainImage-content">';d+='	<img alt="Main Image Blank" src="'+contextPath+'/resources/images/jt-introduce-home-blank.png" title="'+htmlChars(c.name)+'"/>	';d+="</div>"}for(var q=0,w=k.length;q<w;q++){var g=k[q];var x=contextPath+"/photo/thumbnail/"+g.saveName+"represent."+g.type;if(g.category=="0"){x=contextPath+"/resources/uploadImage/"+g.saveName}d+='<div class="mm-home-mainImage-content">';d+='	<img alt="Main Image" src="'+x+'" title="'+htmlChars(c.name)+'"/>	';d+="</div>"}var n=!nullValueCheck(c.customerPn)?"mm-home-love-click":"";var v=!nullValueCheck(c.customerPn)?"mm-home-love-number-click":"";var u='<span class="mm-home-hot" title="최근 뜨는 미니샵">HOT</span>';var m="66";if(nullValueCheck(c.loveHotCount)||c.loveHotCount==0){u="";m="39"}var s=c.newProduct>0?"display: block;":"display:none;";var b=c.newBanner?"display: block;":"display:none;";var o="";if(e.length>0){o+='<div class="mm-home-shop-comments-wrap">';for(var q=0,w=e.length;q<w;q++){var a=e[q];o+='<div class="mm-home-shop-comments">'+htmlChars(a.comment)+"</div>"}o+="</div>"}l+='<article class="mm-home-article" data-spn="'+f+'">';l+='	<header class="mm-home-article-header">';l+='		<a href="'+c.shopUrl+'" target="_blank">'+htmlChars(c.name)+"</a>";l+="	</header>";l+="	<article>";l+='		<ul class="mm-home-mainImage">';l+="			<li>";l+="				"+d;l+='				<div class="mm-home-mainImage-event">';l+='					<div id="new-product-'+c.pn+'" class="mm-home-article-new-wrap" style="'+s+'">';l+='						<span class="mm-home-article-product-new">New product</span>';l+="					</div>";l+='					<div id="new-'+c.pn+'"  class="mm-home-article-new-wrap" style="'+b+'">';l+='						<span class="mm-home-article-event-new">New event</span>';l+="					</div>";l+="				</div>";l+="			</li>";l+="		</ul>";l+="		<div>";l+='			<div class="mm-home-article-quotationmark-first"><span>"</span></div>';l+='			<pre class="mm-home-article-notice">'+htmlChars(c.notice)+"</pre>";l+='			<div class="mm-home-article-quotationmark-last"><span>"</span></div>';l+="		</div>";l+="	</article>";l+="	<footer>";l+="		<ul>";l+="			<li>";l+='				<div style="width: 35px;">';l+='					<span class="mm-home-view" title="최근 일주일간 방문수">View</span><span  class="mm-home-number" id="view-'+f+'">'+(nullValueCheck(c.viewCount)?0:c.viewCount)+"</span>";l+="				</div>";l+="			</li>";l+="			<li>";l+='				<div style="width: 35px;">';l+='					<span class="mm-home-comment">Comment</span><span class="mm-home-number" id="comment-'+f+'">'+(nullValueCheck(c.commentCount)?0:c.commentCount)+"</span>";l+="				</div>";l+="			</li>";l+="			<li>";l+='				<div style="width: '+m+'px;">';l+='					<div class="mm-love-click-wrap">';l+='						<div class="mm-love-click-background" id="jt-heart-click-'+f+'">';l+='							<img alt="Love Background" src="'+contextPath+'/resources/images/heart-background.png">';l+="						</div>";l+='						<div class="mm-love-click">';l+='							<span class="mm-home-love '+n+'" id="love-image-'+f+'">Love</a>';l+="						</div>";l+="					</div>";l+="					<div>";l+='						<span id="love-'+f+'" class="mm-home-number '+v+'">'+(nullValueCheck(c.loveCount)?0:c.loveCount)+"</span>";l+="					</div>";l+="					"+u;l+="				</div>";l+="			</li>";l+="		</ul>";l+="		"+o;l+="	</footer>";l+="</article>"}return l};function trim(a){a=a.replace(/^\s*/,"");a=a.replace(/\s*$/,"");return a}function htmlChars(a){if(nullValueCheck(a)){return""}var b=((a.replace('"',"&amp;")).replace('"',"&quot;")).replace("'","&#39;");return(b.replace("<","&lt;")).replace(">","&gt;")}function fmtNumber(b){var a=/(^[+-]?\d+)(\d{3})/;b+="";while(a.test(b)){b=b.replace(a,"$1,$2")}return b}function nullValueCheck(a){if(a==null||a==undefined||a==""||a=="undefined"){return true}return false};