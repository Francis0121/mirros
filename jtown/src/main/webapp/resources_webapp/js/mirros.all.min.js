$(function(){if($.checkAppPage()){$.pagingItem(1);$.scrollPaging();$.setCategory();$.hotNewChangeBtnInit()}$(document).on("pagechange",function(){if($.checkAppPage()){$.hotNewChangeBtnInit();$.pagingItem();$.setCategory();$.scrollPaging()}})});$itemWrapStaticTarget=null;$.checkAppPage=function(){if($(".jt-app-header-category:last").attr("data-category-type")=="app"){return true}else{return false}};var scrollLoadTimer=null;$.pagingItem=function(d){clearInterval(scrollLoadTimer);var c=null;var b=$(".jt-app-header-search").attr("data-search");var a=$(".jt-app-header-category:last").attr("data-category");$(".jt-app-item-content").attr("data-nav")=="H"?c="H":c=null;$.post(contextPath+"/app/ajax/productPagination.jt",{navFlag:c,categoryPn:a,itemName:b,init:d},function(f){if(f.mergeItems.length>0){$.attendProductItems(f)}else{$.toast("마지막 페이지입니다.")}})};var isScrollingFlag=0;$.scrollPaging=function(){var a=0;if($.isIOS()){a=60}var b=null;$(".jt-app-contents-wrap").scroll(function(){if($.checkAppPage()){isScrollingFlag=1;b=setTimeout(function(){isScrollingFlag=0},1500);if($(".jt-app-contents-wrap:last").scrollTop()+$(".jt-app-contents-wrap:last").height()+a>=$(".jt-app-contents-wrap:last")[0].scrollHeight){scrollLoadTimer=setInterval($.pagingItem(),500);return}}})};$.attendProductItems=function(f){var d="";var b=f.mergeItems;for(var a=0,c=b.length;a<c;a++){var g="";b[a].customerPn==null?g="":g="jt-app-item-like-check";if(b[a].eventPn==0){d+='<div class="jt-app-item-list-products jt-app-item-lists '+g+'" data-url="'+b[a].url+'" data-product-pn="'+b[a].productPn+'" data-like="'+b[a].customerPn+'">';d+='<div class="jt-app-item-list-wrap"></div>';d+='<div class="jt-app-item-img-shield"></div>';if(b[a].hot==1){d+='<div class="jt-app-item-list-products-hot"><img src="'+contextPath+'/resources/images/jt-hot.png"></div>'}d+='<div class="jt-app-item-list-products-img">';if(b[a].contentType==""){d+='<img src="'+contextPath+"/resources/uploadImage/"+b[a].saveName+'" />'}else{d+='<img src="'+contextPath+"/photo/thumbnail/"+b[a].saveName+"product."+b[a].contentType+'" />'}d+="</div>";d+='<div class="jt-app-item-list-products-name">'+$.reduceText(11,b[a].productName)+"</div>";d+='<div class="jt-app-item-list-products-price">'+$.formatNumber(b[a].price)+"원</div>";d+='<div class="jt-app-item-list-reply">';if(b[a].comment==null){d+="&nbsp; "}else{d+='"'+$.reduceText(10,b[a].comment)+'"'}d+="</div>";d+='<div class="jt-app-reply-wrap"></div>';d+="</div>"}else{d+='<div class="jt-app-item-list-events jt-app-item-lists '+g+'" data-url="'+b[a].url+'" data-event-pn="'+b[a].eventPn+'" data-like="'+b[a].customerPn+'" oncontextmenu="return false" onselectstart="return false">';d+='<div class="jt-app-item-list-wrap"></div>';d+='<div class="jt-app-item-img-shield"></div>';d+='<div class="jt-app-item-event-wrap"><img src="'+contextPath+'/resources_webapp/images/jt-dummy.png" /><span class="jt-app-event-mark jt-app-reply-event-mark"> </span></div>';d+='<div class="jt-app-item-event-name">'+b[a].eventName+"</div>";d+='<div class="jt-app-item-event-contents">';d+='<div class="jt-app-item-shop-name">'+b[a].shopName+"</div>";d+='<div class="jt-app-item-end-date">D-'+b[a].endDate+'일 남았습니다.<span class="jt-app-item-dummy-font">&nbsp;</span></div>';d+="</div>";d+='<div class="jt-app-item-list-reply">';if(b[a].comment==null){d+="&nbsp; "}else{d+='"'+$.reduceText(10,b[a].comment)+'"'}d+="</div>";d+='<div class="jt-app-reply-wrap"></div>';d+="</div>"}}$(".jt-app-item-list").append(d)};$.hotNewChangeBtnInit=function(){$(".jt-app-item-content").attr("data-nav")=="H"?$(".jt-app-item-change-mode").text("NEW"):$(".jt-app-item-change-mode").text("HOT")};$("body").on("tap",".jt-app-item-change-mode",function(){if($(".jt-app-item-content").attr("data-nav")=="H"){$.mobile.showPageLoadingMsg();$.mobile.changePage(contextPath+"/app",{transition:"flip",type:"post",reloadPage:true,reverse:true,data:{categoryPn:$(".jt-app-header-category:last").attr("data-category")}});$.mobile.hidePageLoadingMsg()}else{$.mobile.showPageLoadingMsg();$.mobile.changePage(contextPath+"/app",{transition:"flip",type:"post",reloadPage:true,reverse:false,data:{navFlag:"H",categoryPn:$(".jt-app-header-category:last").attr("data-category")}});$.mobile.hidePageLoadingMsg()}});var isTapHold=false;$("body").on("taphold",".jt-app-item-lists",function(a){isTapHold=true;var c=$(this).attr("data-product-pn");var b=$(this).attr("data-event-pn");$itemWrapStaticTarget=$(this);$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(d){if(d.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{$(".jt-app-item-like-popup-dialog").attr("data-product-pn",c);$(".jt-app-item-like-popup-dialog").attr("data-event-pn",b);if($itemWrapStaticTarget.attr("data-like")=="null"){$(".jt-app-item-like-popup-q-text").text("체크리스트에 추가하시겠습니까?");$(".jt-app-item-like-popup-ok").find(".ui-btn-text").text("추가")}else{$(".jt-app-item-like-popup-q-text").text("체크리스트에서 제거하시겠습니까?");$(".jt-app-item-like-popup-ok").find(".ui-btn-text").text("제거")}$(".jt-app-item-like-popup-dialog").popup("open")}})});$("body").on("tap",".jt-app-item-like-popup-ok",function(){var b=$(".jt-app-item-like-popup-dialog").attr("data-product-pn");var a=$(".jt-app-item-like-popup-dialog").attr("data-event-pn");$.thisItem=$itemWrapStaticTarget;if(a==null){$.post(contextPath+"/ajax/productHeartClickMobile.jt",{productPn:b},function(f){var c=f.crudType,d=f.message;if(d=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{if(d=="2"){$.toast("판매자는 불가능합니다");return}}$(".jt-app-item-like-popup-dialog").popup("close");$(".jt-app-item-like-popup-dialog").attr("data-product-pn",null);if("productHeartInsert"==c){$.toast("체크리스트에 추가되었습니다.");$.thisItem.find(".jt-app-item-list-wrap").css("box-shadow","0 0 4px 4px rgba(255,136,0,0.3)").fadeIn(250).delay(500).fadeOut(1000);$.thisItem.addClass("jt-app-item-like-check")}else{if("productHeartDelete"==c){$.toast("체크리스트에서 제거되었습니다.");$.thisItem.find(".jt-app-item-list-wrap").css("box-shadow","0 0 4px 4px rgba(0,0,0,0.2)").fadeIn(250).delay(500).fadeOut(1000);$.thisItem.removeClass("jt-app-item-like-check")}}})}else{if(b==null){$.post(contextPath+"/ajax/eventHeartClickMobile.jt",{eventPn:a},function(f){var c=f.crudType,d=f.message;if(d=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{if(d=="2"){$.toast("판매자는 불가능합니다");return}}$(".jt-app-item-like-popup-dialog").popup("close");$(".jt-app-item-like-popup-dialog").attr("data-event-pn",null);if("eventHeartInsert"==c){$.toast("체크리스트에 추가되었습니다.");$.thisItem.find(".jt-app-item-list-wrap").css("box-shadow","0 0 3px 3px rgba(255,136,0,0.25)").fadeIn(250).delay(500).fadeOut(500);$.thisItem.addClass("jt-app-item-like-check")}else{if("eventHeartDelete"==c){$.toast("체크리스트에서 제거되었습니다.");$.thisItem.find(".jt-app-item-list-wrap").css("box-shadow","0 0 3px 3px rgba(0,0,0,0.075)").fadeIn(250).delay(500).fadeOut(500);$.thisItem.removeClass("jt-app-item-like-check")}}})}}});$("body").on("tap",".jt-app-item-like-popup-cancel",function(a){$(".jt-app-item-like-popup-dialog").popup("close");a.stopPropagation();a.preventDefault()});$("body").on("tap",".jt-app-item-list-products",function(a){if(isScrollingFlag==0){if(!isTapHold){var b=$(this).attr("data-product-pn");$.insertProductClickStatistic(b);window.open($(this).attr("data-url"))}else{isTapHold=false}}else{a.stopPropagation();a.preventDefault()}});$("body").on("tap",".jt-app-item-list-events",function(){if(isScrollingFlag==0){if(!isTapHold){var a=$(this).attr("data-event-pn");$.insertEventClickStatistic(a);window.open($(this).attr("data-url"))}else{isTapHold=false}}else{e.stopPropagation();e.preventDefault()}});$("body").on("tap",".jt-app-item-list-reply",function(a){if(isScrollingFlag==0){a.stopPropagation();a.preventDefault();$pThis=$(this);$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(b){if(b.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{$.replyDialog(a,$pThis)}})}else{a.stopPropagation();a.preventDefault()}});$("body").on("tap",".jt-app-reply-wrap",function(a){if(isScrollingFlag==0){a.stopPropagation();a.preventDefault();$pThis=$(this);$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(b){if(b.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{$.replyDialog(a,$pThis)}})}else{a.stopPropagation();a.preventDefault()}});$.replyDialog=function(a,b){a.stopPropagation();a.preventDefault();$("#jt-app-reply-dialog").popup("open");$eventPn=b.parents(".jt-app-item-lists").attr("data-event-pn");$productPn=b.parents(".jt-app-item-lists").attr("data-product-pn");$itemWrapStaticTarget=b.parents(".jt-app-item-lists");$eventPn==null?$("#jt-app-reply-dialog").attr("data-product-pn",$productPn):$("#jt-app-reply-dialog").attr("data-event-pn",$eventPn)};$("body").on("tap",".jt-app-reply-submit",function(){$inputText=$(".jt-app-reply-input-text").val();var b=$("#jt-app-reply-dialog").attr("data-product-pn");var a=$("#jt-app-reply-dialog").attr("data-event-pn");b==null?b=0:a=0;if($inputText==""){$.toast("글을 입력해주세요.");return}$.postJSON(contextPath+"/ajax/insertComment.jt",{productPn:b,eventPn:a,comment:$inputText},function(c){$(".jt-app-reply-input-text").val("");$(".jt-app-reply-submit").removeClass("jt-btn-orange");$(".jt-app-reply-submit").addClass("jt-btn-gray");$("#jt-app-reply-dialog").popup("close");if(c.comment.message=="1"){$.toast("로그인 하셔야합니다.");$.changePageTransition("/app/login","pop");return}else{if(c.comment.message=="2"){$.toast("판매자는 불가능합니다");return}else{if(c.comment.message=="3"){$.toast("한 상품에 댓글은 한번만 가능합니다.");return}}}$itemWrapStaticTarget.find(".jt-app-item-list-reply").text('"'+$.reduceText(11,c.comment.comment)+'"')})});$("body").on("keyup",".jt-app-reply-input-text",function(){if($(".jt-app-reply-input-text").val().length==0){$(".jt-app-reply-submit").removeClass("jt-btn-orange");$(".jt-app-reply-submit").addClass("jt-btn-gray")}else{$(".jt-app-reply-submit").addClass("jt-btn-orange");$(".jt-app-reply-submit").removeClass("jt-btn-gray")}});$(function(){});$.checkLikePage=function(){if($(".jt-app-header-category:last").attr("data-category-type")=="like"){return true}else{return false}};$.staticLikeWrap=null;$("body").on("tap",".jt-app-like-popup-ok",function(){var b=$(".jt-app-like-popup-dialog").attr("data-product-pn");var a=$(".jt-app-like-popup-dialog").attr("data-event-pn");$.thisItem=$.staticLikeWrap;if(a==null){$.post(contextPath+"/ajax/productHeartClickMobile.jt",{productPn:b},function(f){var c=f.crudType,d=f.message;if(d=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{if(d=="2"){$.toast("판매자는 불가능합니다");return}}if("productHeartDelete"==c){$(".jt-app-like-popup-dialog").attr("data-product-pn",null);$(".jt-app-like-popup-dialog").popup("close");$.toast("체크리스트에서 제거되었습니다.");$.thisItem.remove()}})}else{if(b==null){$.post(contextPath+"/ajax/eventHeartClickMobile.jt",{eventPn:a},function(f){var c=f.crudType,d=f.message;if(d=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{if(d=="2"){$.toast("판매자는 불가능합니다");return}}if("eventHeartDelete"==c){$(".jt-app-like-popup-dialog").attr("data-event-pn",null);$(".jt-app-like-popup-dialog").popup("close");$.toast("체크리스트에서 제거되었습니다.");$.thisItem.remove()}})}}});$("body").on("tap",".jt-app-like-popup-cancel",function(a){$(".jt-app-like-popup-dialog").popup("close");a.stopPropagation();a.preventDefault()});$("body").on("taphold",".jt-app-like-lists",function(){isTapHold=true;var b=$(this).attr("data-product-pn");var a=$(this).attr("data-event-pn");$.staticLikeWrap=$(this);$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(c){if(c.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{$(".jt-app-like-popup-dialog").attr("data-product-pn",b);$(".jt-app-like-popup-dialog").attr("data-event-pn",a);$(".jt-app-like-popup-dialog").popup("open")}})});$(function(){!$.isMobile()?$(".jt-app-more-cacao-invite").hide():null});$(document).on("pageinit",function(){!$.isMobile()?$(".jt-app-more-cacao-invite").hide():null});$(document).on("pageshow",function(){if("app/login"==document.URL.substring(document.URL.lastIndexOf("app"))){if($.isIOS()){$(".jt-app-more-login-message-box").css("bottom",80)}$(".jt-app-more-login-message-box").css("display","block")}else{if("app/emailLogin"==document.URL.substring(document.URL.lastIndexOf("app"))){if(!$.isIOS()){$(".jt-app-more-login-message-box").css("display","block")}}else{if("app/individual"==document.URL.substring(document.URL.lastIndexOf("app"))){$.get(contextPath+"/individual",{},function(a){$(".jt-app-pre-text").html(a.substring(a.search("<pre>")+5,a.search("</pre>")-6))})}else{if("app/agreement"==document.URL.substring(document.URL.lastIndexOf("app"))){$.get(contextPath+"/agreement",{},function(a){$(".jt-app-pre-text").html(a.substring(a.search("<pre>")+5,a.search("</pre>")-6))})}else{if("app/mirros"==document.URL.substring(document.URL.lastIndexOf("app"))){$.get(contextPath+"/help/serviceGuide",{},function(b){var a=b.substring(b.search('<section class="jt-about-mirrosis">'),b.search("</section>")+10);$(".jt-app-mirrosis").html(a)})}}}}}});$.fbLogin=function(){var a=$(".jt-app-more-fb-form")[0];a.submit()};$.logout=function(){$.post(contextPath+"/login/logout",{},function(a){$.changePageTransition("/app","fade",false)})};$.goEmailLogin=function(){$.changePageTransition("/app/emailLogin","fade",false)};$.emailLogin=function(){$.post(contextPath+"/j_spring_security_check",{j_username:$(".jt-login-form-table-input").val(),j_password:$(".jt-login-form-table-password").val()},function(a){if("success"==a.result){$.changePageTransition("/app","fade",false)}else{alert("로그인에 실패하였습니다.")}})};$.goJoin=function(){$.changePageTransition("/app/join","fade",false)};$.joinSubmit=function(){$.mobile.showPageLoadingMsg();$.post(contextPath+"/login/appJoinSubmit.jt",{name:$(".jt-join-direct-user-name").val(),username:$(".jt-join-direct-user-username").val(),password:$(".jt-join-direct-user-password").val(),confirmPassword:$(".jt-join-direct-user-confirmPassword").val()},function(a){$.mobile.hidePageLoadingMsg();if(a=="success"){$.changePageTransition("/app","fade",false)}else{$(".jt-join-direct-user-name").val("");$(".jt-join-direct-user-username").val("");$(".jt-join-direct-user-password").val("");$(".jt-join-direct-user-confirmPassword").val("");$(".jt-app-more-join-name-check").text("");$(".jt-join-direct-user-username-check").text("");$(".jt-join-direct-user-password-check").text("");$(".jt-join-direct-user-confirmPassword-check").text("");$.toast("잘못된 정보를 입력하셨습니다.")}})};$("body").on("focusout",".jt-join-direct-user-name",function(){$.post(contextPath+"/login/nameValidation.jt",{name:this.value},function(a){a=="success"?$(".jt-app-more-join-name-check").text("O"):$(".jt-app-more-join-name-check").text("X")})});$("body").on("focusout",".jt-join-direct-user-username",function(){$.post(contextPath+"/login/usernameValidation.jt",{username:this.value},function(a){a=="success"?$(".jt-join-direct-user-username-check").text("O"):$(".jt-join-direct-user-username-check").text("X")})});$("body").on("focusout",".jt-join-direct-user-password",function(){this.value.length>=8&&this.value.length<=16?$(".jt-join-direct-user-password-check").text("O"):$(".jt-join-direct-user-password-check").text("X")});$("body").on("focusout",".jt-join-direct-user-confirmPassword",function(){$(".jt-join-direct-user-password").val()==this.value&this.value!=""?$(".jt-join-direct-user-confirmPassword-check").text("O"):$(".jt-join-direct-user-confirmPassword-check").text("X")});$.checkMorePage=function(){if($(".jt-app-header-category:last").attr("data-category-type")=="more"){return true}else{return false}};$("body").on("tap",".jt-app-more-cacao-invite",function(){$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(a){if(a.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{kakao.link("talk").send({msg:a.name+"님이 여자를 위한 잇 아이템 Mirros로의 초대장을 보내셨습니다.",url:"http://218.55.100.41:8080/jtown/app",appid:"http://218.55.100.41:8080/jtown/app",appver:"2.0",appname:"Mirros",metainfo:JSON.stringify({metainfo:[{os:"android",devicetype:"phone",installurl:"market://details?id=com.kakao.talk",executeurl:"kakaoagit://testtest"},{os:"ios",devicetype:"phone",installurl:"items://itunes.apple.com/us/app/kakaotalk/id362057947?mt=8",executeurl:"kakaoagit://testtest"}]}),type:"app"})}})});$("body").on("tap",".jt-app-more-facebook-invite",function(){$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(a){if(a.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{FB.getLoginStatus(function(b){if(b.status=="connected"){getCurrentUserInfo(b)}else{$.toast("페이스북으로 로그인 하셔야 합니다.")}})}})});function getCurrentUserInfo(){FB.api("/me",function(a){FB.ui({method:"apprequests",message:a.name+"님이 여자를 위한 잇 아이템 Mirros로의 초대장을 보내셨습니다."},requestCallback)})}function requestCallback(a){$.toast("초대장을 발송하였습니다.")}$(function(){});$("body").on("tap",".jt-app-reply-comment-wrap",function(){if(!isTapHold){var b=$(this).find(".jt-app-reply-event-wrap").attr("data-eventPn");var a=$(this).find(".jt-app-reply-img-wrap").attr("data-productPn");a==null?$.insertEventClickStatistic(b):$.insertProductClickStatistic(a);window.open($(this).attr("data-url"))}else{isTapHold=false}});$.checkReplyPage=function(){if($(".jt-app-header-category:last").attr("data-category-type")=="reply"){return true}else{return false}};$.deleteTarget=null;$("body").on("taphold",".jt-app-reply-comment-wrap",function(){isTapHold=true;$.post(contextPath+"/app/ajax/checkLogin.jt",{},function(b){if(b.isLogin==false){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop");return}else{var d=b.pn;$("#jt-reply-popup-menu").popup("open");var g=$(this).find(".jt-app-reply-event-wrap").attr("data-eventPn");var f=$(this).find(".jt-app-reply-img-wrap").attr("data-productPn");var c=$(this).attr("data-comment-pn");var a=$(this).attr("data-customer-pn");d!=a?$(".jt-app-reply-popup-delete").hide():$(".jt-app-reply-popup-delete").show();$.deleteTarget=$(this);$("#jt-reply-popup-menu").attr("data-event-pn",g);$("#jt-reply-popup-menu").attr("data-product-pn",f);$("#jt-reply-popup-menu").attr("data-comment-pn",c)}})});$("body").on("tap",".jt-app-reply-popup-warn",function(){var b=$("#jt-reply-popup-menu").attr("data-product-pn");b==null?b=0:"";var a=$("#jt-reply-popup-menu").attr("data-comment-pn");$.postJSON(contextPath+"/ajax/insertCommentWarn.jt",{commentPn:a,productPn:b},function(c){if(c.message=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop")}else{if(c.message=="2"){$.toast("판매자는 불가능합니다")}else{if(c.message=="3"){$.toast("이미 신고되었습니다.")}else{$.toast("신고되었습니다.");$("#jt-reply-popup-menu").popup("close")}}}$.resetReplyPopup()})});$("body").on("tap",".jt-app-reply-popup-delete",function(){var c=$("#jt-reply-popup-menu").attr("data-product-pn");c==null?c=0:"";var b=$("#jt-reply-popup-menu").attr("data-event-pn");b==null?b=0:"";var a=$("#jt-reply-popup-menu").attr("data-comment-pn");$.postJSON(contextPath+"/ajax/deleteComment.jt",{commentPn:a,productPn:c,eventPn:b},function(d){if(d.message=="1"){$.toast("로그인 해주세요.");$.changePageTransition("/app/login","pop")}else{if(d.message=="2"){$.toast("판매자는 불가능합니다")}else{if(d.message=="3"){$.toast("자신의 글만 삭제할 수 있습니다.")}else{$.toast("삭제되었습니다.");$.deleteTarget.remove();$("#jt-reply-popup-menu").popup("close")}}}$.resetReplyPopup()})});$.resetReplyPopup=function(){$("#jt-reply-popup-menu").removeAttr("data-comment-pn");$("#jt-reply-popup-menu").removeAttr("data-event-pn");$("#jt-reply-popup-menu").removeAttr("data-product-pn")};